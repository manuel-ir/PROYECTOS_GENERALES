<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Mi Pizzería</title>
  <style>
    /* Estilos básicos para validación visual */
    .ok { color: green; }
    .error { color: red; }

    /* Estilo para los contenedores de mensajes y resumen */
    .panel {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
    }

    /* Clase que se activará/desactivará con JS para el modo oscuro */
    .oscuro {
      background-color: #111;
      color: #f5f5f5;
    }
  </style>
</head>

<body id="pagina">
  <h2>Mi Pizzería</h2>

  <button id="modoBtn">Modo oscuro</button>

  <form id="form">
    <p><label>Nombre: <input type="text" id="nombre"></label></p>
    <p><label>Teléfono: <input type="text" id="telefono" placeholder="9 dígitos"></label></p>
    <p><label>Email: <input type="text" id="email" placeholder="ejemplo@correo.com"></label></p>

    <p><strong>Tamaño:</strong>
      <select id="tamano">
        <option value="">-- selecciona --</option>
        <option value="0">Pequeña 8€</option>
        <option value="1">Mediana 12€</option>
        <option value="2">Grande 20€</option>
      </select>
    </p>

    <p><strong>Ingredientes extra:</strong><br>
      <label><input type="checkbox" class="extra" value="0"> Queso extra +1€</label>
      <label><input type="checkbox" class="extra" value="1"> Champiñones +1,50€</label>
      <label><input type="checkbox" class="extra" value="2"> Pepperoni +2€</label>
    </p>

    <p>
      <button type="button" id="calcularBtn">Calcular total</button>
      <button type="submit" id="enviarBtn" disabled>Enviar pedido</button>
    </p>
  </form>

  <div id="mensajes" class="panel"></div>
  <div id="resumen" class="panel"></div>

  <script>
    /* -----------------------------------------------------
       1. DATOS (ARRAYS)
       Tal como pide el ejercicio, usamos arrays para los precios.
       Los índices coinciden con los 'value' del HTML.
       ----------------------------------------------------- */
    const precios = {
      tamanos: [8, 12, 20],      // 0: Pequeña, 1: Mediana, 2: Grande
      ingredientes: [1, 1.5, 2]  // 0: Queso, 1: Champi, 2: Pepperoni
    };

    /* Variables de estado para controlar la lógica */
    let modoOscuro = false;
    let pedidoValido = false; // Controla si se puede pulsar "Enviar"

    /* 2. CACHÉ DE ELEMENTOS DOM
       Guardamos todos los elementos en un objeto constante al principio.
       Esto es una BUENA PRÁCTICA (mejor que hacer document.getElementById cada vez).
    */
    const elementos = {
      pagina: document.getElementById("pagina"), // El body
      modoBtn: document.getElementById("modoBtn"),
      form: document.getElementById("form"),
      nombre: document.getElementById("nombre"),
      telefono: document.getElementById("telefono"),
      email: document.getElementById("email"),
      tamano: document.getElementById("tamano"),
      // querySelectorAll devuelve una lista de nodos (NodeList) con todos los checkbox
      extras: document.querySelectorAll(".extra"),
      calcularBtn: document.getElementById("calcularBtn"),
      enviarBtn: document.getElementById("enviarBtn"),
      mensajes: document.getElementById("mensajes"),
      resumen: document.getElementById("resumen")
    };

    /* -----------------------------------------------------
       3. EVENTOS (addEventListener)
       Esperamos a que el DOM cargue (DOMContentLoaded) antes de asignar eventos.
       ----------------------------------------------------- */
    document.addEventListener("DOMContentLoaded", function () {
      // Evento Click para el modo oscuro
      elementos.modoBtn.addEventListener("click", alternarModo);
      
      // Evento Click para calcular (botón tipo button)
      elementos.calcularBtn.addEventListener("click", calcularTotal);
      
      // Evento Submit para el envío final (prevenir recarga)
      elementos.form.addEventListener("submit", procesarPedido);
      
      // Evento Input en el formulario: se dispara cada vez que escribes o cambias algo.
      // Sirve para validar en tiempo real.
      elementos.form.addEventListener("input", validarFormulario);
    });

    /* -----------------------------------------------------
       4. FUNCIONES DE LÓGICA Y DOM
       ----------------------------------------------------- */

    // Función para cambiar clases CSS (classList)
    function alternarModo() {
      modoOscuro = !modoOscuro; // Invierte el valor (true -> false, false -> true)

      if (modoOscuro) {
        elementos.pagina.classList.add("oscuro"); // Añade clase CSS
        elementos.modoBtn.textContent = "Modo claro"; // Cambia texto botón
      } else {
        elementos.pagina.classList.remove("oscuro"); // Quita clase CSS
        elementos.modoBtn.textContent = "Modo oscuro";
      }
    }

    /* --- VALIDACIONES INDIVIDUALES --- */
    
    // Valida nombre: no vacío y longitud mínima
    function validarNombre() {
      const nombre = elementos.nombre.value.trim(); // .trim() quita espacios extra
      // Busca si ya existe un span de error, si no, lo crea dinámicamente
      const mensaje = document.getElementById("mensaje-nombre") || crearMensaje("nombre");

      if (nombre === "") {
        mostrarError(mensaje, "El nombre es obligatorio");
        return false;
      } else if (nombre.length < 2) {
        mostrarError(mensaje, "El nombre debe tener al menos 2 caracteres");
        return false;
      } else {
        mostrarOk(mensaje, "Nombre válido");
        return true;
      }
    }

    // Valida teléfono: OJO, aquí tu compañero solo valida que no esté vacío.
    // Para el 10, debería validar longitud 9: if (telefono.length !== 9 || isNaN(telefono))
    function validarTelefono() {
      const telefono = elementos.telefono.value.trim();
      const mensaje = document.getElementById("mensaje-telefono") || crearMensaje("telefono");
      
      if (telefono === "") {
        mostrarError(mensaje, "El teléfono es obligatorio");
        return false;
      } else {
        mostrarOk(mensaje, "Teléfono válido");
        return true;
      }
    }

    // Valida email: igual, solo valida que no esté vacío (básico).
    function validarEmail() {
      const email = elementos.email.value.trim();
      const mensaje = document.getElementById("mensaje-email") || crearMensaje("email");

      if (email === "") {
        mostrarError(mensaje, "El email es obligatorio");
        return false;
      } else {
        mostrarOk(mensaje, "Email válido");
        return true;
      }
    }

    // Valida tamaño: se asegura de que no sea la opción por defecto ("")
    function validarTamano() {
      const tamano = elementos.tamano.value;
      const mensaje = document.getElementById("mensaje-tamano") || crearMensaje("tamano");

      if (tamano === "") {
        mostrarError(mensaje, "Debes seleccionar un tamaño");
        return false;
      } else {
        mostrarOk(mensaje, "Tamaño seleccionado");
        return true;
      }
    }

    /* --- ORQUESTADOR DE VALIDACIÓN --- */
    // Esta función llama a todas las anteriores. Si TODAS son true, habilita el botón.
    function validarFormulario() {
      const nombreValido = validarNombre();
      const telefonoValido = validarTelefono();
      const emailValido = validarEmail();
      const tamanoValido = validarTamano();

      // Operador AND (&&): Todas deben ser verdaderas
      pedidoValido = nombreValido && telefonoValido && emailValido && tamanoValido;
      
      // Si pedidoValido es true, disabled es false (botón activo)
      elementos.enviarBtn.disabled = !pedidoValido;

      return pedidoValido;
    }

    /* --- UTILIDADES DOM (Crear y mostrar mensajes) --- */
    // Crea un <span> dinámicamente justo al lado del input correspondiente
    function crearMensaje(campo) {
      const mensaje = document.createElement("span");
      mensaje.id = `mensaje-${campo}`; // Crea IDs dinámicos: mensaje-nombre, mensaje-email...
      mensaje.style.marginLeft = "10px";

      const campoElemento = elementos[campo];
      // appendChild inserta el span después del input (en su padre)
      campoElemento.parentNode.appendChild(mensaje);

      return mensaje;
    }

    // Funciones auxiliares para cambiar texto y color (clase CSS) del mensaje
    function mostrarError(elemento, mensaje) {
      elemento.textContent = mensaje;
      elemento.className = "error"; // Aplica color rojo
    }

    function mostrarOk(elemento, mensaje) {
      elemento.textContent = mensaje;
      elemento.className = "ok"; // Aplica color verde
    }

    /* -----------------------------------------------------
       5. CÁLCULO DEL TOTAL (Lógica principal con Arrays)
       ----------------------------------------------------- */
    function calcularTotal() {
      // 1. Verificar si hay errores antes de calcular
      if (!validarFormulario()) {
        elementos.resumen.innerHTML = '<p class="error">Por favor, completa todos los campos obligatorios antes de calcular el total.</p>';
        return; // Detiene la función aquí
      }

      let total = 0;

      // 2. Obtener precio base del array usando el índice (value del select)
      const tamanoIndex = parseInt(elementos.tamano.value); // "0", "1" o "2" -> 0, 1, 2
      total += precios.tamanos[tamanoIndex]; // Suma 8, 12 o 20

      // 3. Obtener extras recorriendo los checkbox (forEach)
      let ingredientesSeleccionados = [];
      elementos.extras.forEach(extra => {
        if (extra.checked) { // Si la casilla está marcada
          const ingredienteIndex = parseInt(extra.value); // Toma el valor (0, 1, 2)
          total += precios.ingredientes[ingredienteIndex]; // Suma precio del array
          
          // Guarda el nombre del ingrediente (texto del padre label) para el resumen
          ingredientesSeleccionados.push(extra.parentNode.textContent.trim());
        }
      });

      // 4. Mostrar Resumen usando Template Strings (``) e innerHTML
      const nombresTamanos = ["Pequeña", "Mediana", "Grande"];
      
      // Operador ternario para listar ingredientes o poner "Ninguno"
      // toFixed(2) fuerza mostrar 2 decimales (ej: 10.50)
      elementos.resumen.innerHTML = `
        <h3>Resumen de tu pedido</h3>
        <p><strong>Nombre:</strong> ${elementos.nombre.value}</p>
        <p><strong>Teléfono:</strong> ${elementos.telefono.value}</p>
        <p><strong>Email:</strong> ${elementos.email.value}</p>
        <p><strong>Tamaño:</strong> ${nombresTamanos[tamanoIndex]} - ${precios.tamanos[tamanoIndex]}€</p>
        ${ingredientesSeleccionados.length > 0 ?
           `<p><strong>Ingredientes extra:</strong> ${ingredientesSeleccionados.join(", ")}</p>` :
           "<p><strong>Ingredientes extra:</strong> Ninguno</p>"
        }
        <p><strong>Total:</strong> ${total.toFixed(2)}€</p>
      `;
    }

    /* -----------------------------------------------------
       6. PROCESAR PEDIDO (Submit)
       ----------------------------------------------------- */
    function procesarPedido(evento) {
      // PREVENIR el comportamiento por defecto (que la página se recargue)
      evento.preventDefault();

      if (!pedidoValido) {
        elementos.mensajes.innerHTML = '<p class="error">Por favor, completa todos los campos correctamente.</p>';
        return;
      }
      
      // Mostrar mensaje de éxito final
      elementos.mensajes.innerHTML = '<p class="ok">¡Pedido enviado correctamente! Te contactaremos pronto.</p>';

      // LIMPIEZA DEL FORMULARIO
      elementos.form.reset(); // Borra los inputs
      elementos.resumen.innerHTML = ""; // Borra el resumen visual
      elementos.enviarBtn.disabled = true; // Desactiva el botón de nuevo

      // Borra los mensajitos de validación (span) que creamos
      document.querySelectorAll('[id^="mensaje-"]').forEach(mensaje => {
        mensaje.textContent = "";
      });

      pedidoValido = false; // Reinicia el estado
    }
  </script>
</body>
</html>